generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "mysql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model user {
  id                       Int                        @id @default(autoincrement())
  name                     String
  email                    String?                    @unique
  is_active                Boolean?                   @default(true)
  partner                  Boolean?                   @default(false)
  is_user                  Boolean?                   @default(false)
  password                 String?
  member_id                String?
  position_id              Int?
  department_id            Int?
  created_at               DateTime                   @default(now())
  updated_at               DateTime?
  access_level_id          Int?
  membership_type          membership_type?
  parent_id                Int?
  status                   status_type?
  is_sync                  Boolean?                   @default(false)
  sync_id                  Int?
  mode                     classFormat?
  spouse_id                Int?                       @unique
  appointments             appointment[]
  asset_history            asset_history[]
  assignment_submission    assignment_submission[]
  timeSlots                availability[]
  certificate              certificate[]
  course                   course[]
  department_head          department[]
  department_positions     department_positions[]
  enrollments              enrollment[]
  event_attendance         event_attendance[]
  event_attendance_summary event_attendance_summary[]
  event_registers          event_registers[]
  family_of_links          family_relation[]          @relation("FamilyUser")
  family_links             family_relation[]          @relation("UserFamily")
  followUps                follow_up[]
  life_center_member       life_center_member[]
  notes                    note[]
  orders                   orders[]
  prayerRequests           prayer_request[]
  request                  request[]
  hod_user                 request_approvals[]        @relation("hod_user")
  ps_user                  request_approvals[]        @relation("ps_user")
  user_request_comments    request_comments[]
  soul_won                 soul_won[]                 @relation("user_soul_winner")
  access                   access_level?              @relation(fields: [access_level_id], references: [id])
  parent                   user?                      @relation("UserParent", fields: [parent_id], references: [id])
  children                 user[]                     @relation("UserParent")
  position                 position?                  @relation(fields: [position_id], references: [id])
  spouse                   user?                      @relation("SpouseRelation", fields: [spouse_id], references: [id])
  spouse_of                user?                      @relation("SpouseRelation")
  department               user_departments?
  user_info                user_info?

  @@index([access_level_id], map: "user_access_level_id_fkey")
  @@index([position_id], map: "user_position_id_fkey")
  @@index([parent_id], map: "user_parent_id_fkey")
}

model user_info {
  id                   Int                     @id @default(autoincrement())
  user_id              Int                     @unique
  title                String?
  date_of_birth        DateTime?
  gender               String
  primary_number       String?
  other_number         String?
  email                String?
  address              String?
  country              String?
  city                 String?
  state_region         String?
  occupation           String?
  company              String?
  member_since         DateTime?
  photo                String?
  emergency_contact_id Int?
  first_name           String?
  last_name            String?
  marital_status       marital_status?
  nationality          String?
  other_name           String?
  work_info_id         Int?
  country_code         String?
  payment_info_token   String?                 @unique
  emergency_contact    user_emergency_contact? @relation(fields: [emergency_contact_id], references: [id])
  user                 user                    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  work_info            user_work_info?         @relation(fields: [work_info_id], references: [id])

  @@index([emergency_contact_id], map: "user_info_emergency_contact_id_fkey")
  @@index([work_info_id], map: "user_info_work_info_id_fkey")
}

model family_relation {
  id        Int    @id @default(autoincrement())
  user_id   Int
  family_id Int
  relation  String
  family    user   @relation("FamilyUser", fields: [family_id], references: [id])
  user      user   @relation("UserFamily", fields: [user_id], references: [id])

  @@unique([user_id, family_id])
  @@index([family_id], map: "family_relation_family_id_fkey")
}

model user_work_info {
  id                  Int         @id @default(autoincrement())
  name_of_institution String
  industry            String
  position            String
  employment_status   String?
  school_name         String?
  user_info           user_info[]
}

model user_emergency_contact {
  id           Int         @id @default(autoincrement())
  name         String
  relation     String
  phone_number String
  country_code String?
  user_info    user_info[]
}

model department {
  id                   Int                    @id @default(autoincrement())
  name                 String
  department_head      Int?
  description          String?
  created_by           Int
  created_at           DateTime               @default(now())
  updated_by           Int?
  updated_at           DateTime?
  is_sync              Boolean?               @default(false)
  sync_id              Int?
  assets               assets[]
  department_head_info user?                  @relation(fields: [department_head], references: [id])
  department_positions department_positions[]
  position             position[]
  request              request[]
  user_departments     user_departments[]

  @@index([department_head], map: "department_department_head_fkey")
}

model user_departments {
  id              Int         @id @default(autoincrement())
  user_id         Int         @unique
  department_id   Int?
  department_info department? @relation(fields: [department_id], references: [id])
  user            user        @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([department_id], map: "user_departments_department_id_fkey")
}

model position {
  id                   Int                    @id @default(autoincrement())
  name                 String
  department_id        Int?
  description          String?
  created_by           Int
  created_at           DateTime               @default(now())
  updated_by           Int?
  updated_at           DateTime?
  is_sync              Boolean?               @default(false)
  sync_id              Int?
  department_positions department_positions[]
  department           department?            @relation(fields: [department_id], references: [id])
  user                 user[]

  @@index([department_id], map: "position_department_id_fkey")
}

model access_level {
  id             Int       @id @default(autoincrement())
  name           String    @unique
  description    String?
  permissions    String?   @db.LongText
  created_by     Int?
  updated_by     Int?
  deleted_at     DateTime?
  deleted        Boolean   @default(false)
  created_at     DateTime? @default(now())
  updated_at     DateTime?
  users_assigned user[]
}

model assets {
  id                  Int           @id @default(autoincrement())
  name                String
  date_assigned       DateTime?
  date_purchased      DateTime?
  price               Float?
  description         String?
  updated_at          DateTime?
  supplier            String?
  status              asset_status?
  photo               String?
  created_by          Int?
  updated_by          Int?
  created_at          DateTime      @default(now())
  department_assigned Int?
  asset_id            String?
  assigned_to         department?   @relation(fields: [department_assigned], references: [id])

  @@index([department_assigned], map: "assets_department_assigned_fkey")
}

model asset_history {
  id            Int          @id @default(autoincrement())
  title         String
  description   String?
  status_update asset_status
  update_date   DateTime
  userId        Int?
  related_user  user?        @relation(fields: [userId], references: [id])

  @@index([userId], map: "asset_history_userId_fkey")
}

model event_act {
  id                Int           @id @default(autoincrement())
  event_name        String?       @default("event_name")
  event_status      event_status?
  event_type        event_type?
  event_description String?       @default("event_description")
  event_mgt         event_mgt[]
}

model event_mgt {
  id                   Int                        @id @default(autoincrement())
  start_time           String?
  end_time             String?
  location             String?
  description          String?
  poster               String?
  qr_code              String?
  created_by           Int
  created_at           DateTime                   @default(now())
  updated_by           Int?
  updated_at           DateTime?
  end_date             DateTime?
  start_date           DateTime?
  event_status         event_status?
  event_type           event_type?
  event_name_id        Int
  event_attendance     event_attendance[]
  attendance_summaries event_attendance_summary[]
  event                event_act                  @relation(fields: [event_name_id], references: [id])
  event_registers      event_registers[]
  markets              markets[]
  request              request[]
  visit                visit[]

  @@index([event_name_id], map: "event_mgt_event_name_id_fkey")
}

model event_attendance_summary {
  id              Int              @id @default(autoincrement())
  event_mgt_id    Int
  date            DateTime
  group           attendance_group @default(BOTH)
  adultMale       Int              @default(0)
  adultFemale     Int              @default(0)
  childrenMale    Int              @default(0)
  childrenFemale  Int              @default(0)
  recordedBy      Int
  recordedByName  String
  created_at      DateTime         @default(now())
  updated_at      DateTime?
  newMembers      Int              @default(0)
  visitingPastors Int              @default(0)
  visitors        Int              @default(0)
  youthFemale     Int              @default(0)
  youthMale       Int              @default(0)
  event           event_mgt        @relation(fields: [event_mgt_id], references: [id])
  recordedByUser  user             @relation(fields: [recordedBy], references: [id])

  @@unique([event_mgt_id, date])
  @@index([event_mgt_id])
  @@index([date])
  @@index([recordedBy], map: "event_attendance_summary_recordedBy_fkey")
}

model event_attendance {
  id         Int       @id @default(autoincrement())
  event_id   Int
  user_id    Int
  created_at DateTime  @default(now())
  event      event_mgt @relation(fields: [event_id], references: [id])
  user       user      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([event_id], map: "event_attendance_event_id_fkey")
  @@index([user_id], map: "event_attendance_user_id_fkey")
}

model event_registers {
  id         Int       @id @default(autoincrement())
  event_id   Int
  user_id    Int
  created_at DateTime  @default(now())
  event      event_mgt @relation(fields: [event_id], references: [id])
  user       user      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([event_id], map: "event_attendance_event_id_fkey")
  @@index([user_id], map: "event_attendance_user_id_fkey")
}

model request {
  id                      Int                              @id @default(autoincrement())
  request_id              String
  user_id                 Int
  event_id                Int?
  department_id           Int
  request_approval_status RequestApprovalStatus
  requisition_date        DateTime
  currency                String
  user_sign               String?
  updated_by_user_id      Int?
  updated_at              DateTime?
  attachmentsList         request_attachment[]
  department              department                       @relation(fields: [department_id], references: [id])
  event                   event_mgt?                       @relation(fields: [event_id], references: [id])
  user                    user                             @relation(fields: [user_id], references: [id])
  request_approvals       request_approvals?
  request_comments        request_comments[]
  products                requested_item[]                 @relation("ProductRequest")
  approval_instances      requisition_approval_instances[]

  @@index([user_id], map: "request_user_id_fkey")
  @@index([department_id], map: "request_department_id_fkey")
  @@index([event_id], map: "request_event_id_fkey")
  @@index([updated_by_user_id], map: "request_updated_by_user_id_idx")
}

model requisition_summary {
  requisition_id  Int      @unique
  user_id         Int
  generated_id    String
  product_names   String   @db.LongText
  date_created    DateTime
  approval_status String
  total_amount    Float?
  department_id   Int

  @@map("requisition_summary")
}

model request_comments {
  id                   Int      @id @default(autoincrement())
  request_id           Int?
  user_id              Int?
  comment              String?
  created_at           DateTime @default(now())
  requesition          request? @relation(fields: [request_id], references: [id])
  request_comment_user user?    @relation(fields: [user_id], references: [id])

  @@index([request_id], map: "request_comments_request_id_fkey")
  @@index([user_id], map: "request_comments_user_id_fkey")
}

model request_attachment {
  id         Int      @id @default(autoincrement())
  URL        String
  request_id Int?
  request    request? @relation(fields: [request_id], references: [id])

  @@index([request_id], map: "attachment_request_id_fkey")
  @@map("attachment")
}

model requested_item {
  id         Int     @id @default(autoincrement())
  request_id Int
  name       String
  unitPrice  Float
  quantity   Int
  image_url  String?
  request    request @relation("ProductRequest", fields: [request_id], references: [id])

  @@index([request_id], map: "requested_product_item_request_id_fkey")
  @@map("requested_product_item")
}

model request_approvals {
  id                Int       @id @default(autoincrement())
  request_id        Int?      @unique
  hod_user_id       Int?
  hod_approved      Boolean   @default(false)
  hod_approval_date DateTime?
  hod_sign          String?
  ps_user_id        Int?
  ps_approved       Boolean   @default(false)
  ps_approval_date  DateTime?
  ps_sign           String?
  hod_user          user?     @relation("hod_user", fields: [hod_user_id], references: [id])
  ps_user           user?     @relation("ps_user", fields: [ps_user_id], references: [id])
  request           request?  @relation(fields: [request_id], references: [id])

  @@index([hod_user_id], map: "request_approvals_hod_user_id_fkey")
  @@index([ps_user_id], map: "request_approvals_ps_user_id_fkey")
}

model requisition_approval_configs {
  id         Int                                      @id @default(autoincrement())
  module     RequisitionApprovalModule                @unique
  is_active  Boolean                                  @default(true)
  created_by Int?
  updated_by Int?
  created_at DateTime                                 @default(now())
  updated_at DateTime                                 @default(now()) @updatedAt
  requesters requisition_approval_config_requesters[]
  steps      requisition_approval_config_steps[]
  instances  requisition_approval_instances[]
}

model requisition_approval_config_requesters {
  id        Int                          @id @default(autoincrement())
  config_id Int
  user_id   Int
  config    requisition_approval_configs @relation(fields: [config_id], references: [id], onDelete: Cascade)

  @@unique([config_id, user_id])
  @@index([user_id])
  @@index([config_id])
}

model requisition_approval_config_steps {
  id          Int                          @id @default(autoincrement())
  config_id   Int
  step_order  Int
  step_type   RequisitionApproverType
  position_id Int?
  user_id     Int?
  config      requisition_approval_configs @relation(fields: [config_id], references: [id], onDelete: Cascade)

  @@unique([config_id, step_order])
  @@index([position_id])
  @@index([user_id])
  @@index([config_id])
}

model requisition_approval_instances {
  id                 Int                               @id @default(autoincrement())
  request_id         Int
  config_id          Int
  step_order         Int
  step_type          RequisitionApproverType
  approver_user_id   Int
  position_id        Int?
  configured_user_id Int?
  status             RequisitionApprovalInstanceStatus @default(WAITING)
  acted_by_user_id   Int?
  acted_at           DateTime?
  comment            String?
  created_at         DateTime                          @default(now())
  updated_at         DateTime                          @default(now()) @updatedAt
  config             requisition_approval_configs      @relation(fields: [config_id], references: [id], onDelete: Cascade)
  request            request                           @relation(fields: [request_id], references: [id], onDelete: Cascade)

  @@unique([request_id, step_order])
  @@index([approver_user_id])
  @@index([status])
  @@index([config_id])
}

model requisition_edit_logs {
  id             Int      @id @default(autoincrement())
  requisition_id Int
  editor_user_id Int
  edited_at      DateTime @default(now())
  changed_fields String?  @db.LongText

  @@index([requisition_id], map: "requisition_edit_logs_requisition_id_idx")
  @@index([editor_user_id], map: "requisition_edit_logs_editor_user_id_idx")
  @@index([edited_at], map: "requisition_edit_logs_edited_at_idx")
}

model program {
  id                   Int                     @id @default(autoincrement())
  title                String
  description          String
  completed            Boolean                 @default(false)
  createdAt            DateTime                @default(now())
  updatedAt            DateTime                @updatedAt
  leader_required      Boolean                 @default(false)
  member_required      Boolean                 @default(false)
  ministry_required    Boolean                 @default(false)
  certificate          certificate[]
  cohorts              cohort[]
  requiredForPrograms  program_prerequisites[] @relation("ProgramToRequired")
  prerequisitePrograms program_prerequisites[] @relation("ProgramToPrerequisite")
  topics               topic[]
}

model program_prerequisites {
  programId      Int
  prerequisiteId Int
  prerequisite   program @relation("ProgramToRequired", fields: [prerequisiteId], references: [id], onDelete: Cascade)
  program        program @relation("ProgramToPrerequisite", fields: [programId], references: [id], onDelete: Cascade)

  @@id([programId, prerequisiteId])
  @@index([prerequisiteId], map: "program_prerequisites_prerequisiteId_fkey")
}

model topic {
  id           Int           @id @default(autoincrement())
  name         String
  programId    Int
  description  String?
  order_number Int?
  LearningUnit LearningUnit?
  progress     progress[]
  program      program       @relation(fields: [programId], references: [id], onDelete: Cascade)

  @@index([programId], map: "topic_programId_fkey")
}

model LearningUnit {
  id                Int                     @id @default(autoincrement())
  topicId           Int                     @unique
  type              String
  data              String                  @db.LongText
  version           Int                     @default(1)
  maxAttempts       Int?                    @default(3)
  topic             topic                   @relation(fields: [topicId], references: [id], onDelete: Cascade)
  submissions       assignment_submission[]
  cohortAssignments cohort_assignment[]
}

model cohort {
  id                  Int                 @id @default(autoincrement())
  name                String
  startDate           DateTime
  status              String
  description         String
  duration            String
  applicationDeadline DateTime
  programId           Int
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  program             program             @relation(fields: [programId], references: [id], onDelete: Cascade)
  assignments         cohort_assignment[]
  courses             course[]

  @@index([programId], map: "cohort_programId_fkey")
}

model course {
  id           Int          @id @default(autoincrement())
  name         String
  capacity     Int
  enrolled     Int          @default(0)
  schedule     String
  cohortId     Int
  classFormat  classFormat?
  location     String?
  meetingLink  String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  instructorId Int?
  cohort       cohort       @relation(fields: [cohortId], references: [id], onDelete: Cascade)
  instructor   user?        @relation(fields: [instructorId], references: [id], onDelete: Cascade)
  enrollments  enrollment[]

  @@index([cohortId], map: "course_cohortId_fkey")
  @@index([instructorId], map: "course_instructorId_fkey")
}

model enrollment {
  id          Int                     @id @default(autoincrement())
  enrolledAt  DateTime                @default(now())
  course_id   Int
  user_id     Int?
  completed   Boolean?                @default(false)
  completedAt DateTime?
  submissions assignment_submission[]
  course      course                  @relation(fields: [course_id], references: [id], onDelete: Cascade)
  user        user?                   @relation(fields: [user_id], references: [id], onDelete: Cascade)
  progress    progress[]

  @@unique([user_id, course_id])
  @@index([course_id], map: "enrollment_course_id_fkey")
}

model progress {
  id           Int             @id @default(autoincrement())
  enrollmentId Int
  topicId      Int
  score        Int             @default(0)
  status       progress_status @default(PENDING)
  completedAt  DateTime?
  notes        String?
  completed    Boolean?        @default(false)
  enrollment   enrollment      @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)
  topic        topic           @relation(fields: [topicId], references: [id], onDelete: Cascade)

  @@unique([enrollmentId, topicId])
  @@index([topicId], map: "progress_topicId_fkey")
}

model cohort_assignment {
  id             Int          @id @default(autoincrement())
  cohortId       Int
  learningUnitId Int
  isActive       Boolean      @default(false)
  activatedAt    DateTime?
  dueDate        DateTime?
  closedAt       DateTime?
  cohort         cohort       @relation(fields: [cohortId], references: [id], onDelete: Cascade)
  learningUnit   LearningUnit @relation(fields: [learningUnitId], references: [id], onDelete: Cascade)

  @@unique([cohortId, learningUnitId])
  @@index([learningUnitId], map: "cohort_assignment_learningUnitId_fkey")
}

model assignment_submission {
  id             Int               @id @default(autoincrement())
  enrollmentId   Int
  learningUnitId Int
  content        String?           @db.LongText
  fileUrl        String?
  attempt        Int               @default(1)
  status         submission_status @default(SUBMITTED)
  submittedAt    DateTime          @default(now())
  score          Int?
  feedback       String?
  gradedById     Int?
  gradedAt       DateTime?
  enrollment     enrollment        @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)
  gradedBy       user?             @relation(fields: [gradedById], references: [id])
  learningUnit   LearningUnit      @relation(fields: [learningUnitId], references: [id], onDelete: Cascade)

  @@index([enrollmentId, learningUnitId])
  @@index([gradedById], map: "assignment_submission_gradedById_fkey")
  @@index([learningUnitId], map: "assignment_submission_learningUnitId_fkey")
}

model visitor {
  id                 Int              @id @default(autoincrement())
  firstName          String
  lastName           String
  email              String?          @unique
  phone              String?
  country            String?
  address            String?
  city               String?
  state              String?
  zipCode            String?
  visitDate          DateTime
  is_member          Boolean          @default(false)
  howHeard           String?
  consentToContact   Boolean          @default(false)
  membershipWish     Boolean          @default(false)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  country_code       String?
  otherName          String?
  title              String?
  responsibleMembers String?          @db.LongText
  followUps          follow_up[]
  notes              note[]
  prayerRequests     prayer_request[]
  visits             visit[]
}

model visit {
  id        Int        @id @default(autoincrement())
  visitorId Int?
  date      DateTime
  eventId   Int?
  notes     String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  event     event_mgt? @relation(fields: [eventId], references: [id])
  visitor   visitor?   @relation(fields: [visitorId], references: [id], onDelete: Cascade)

  @@index([eventId], map: "visit_eventId_fkey")
  @@index([visitorId], map: "visit_visitorId_fkey")
}

model follow_up {
  id         Int      @id @default(autoincrement())
  visitorId  Int
  userId     Int?
  date       DateTime
  type       String
  status     String   @default("pending")
  notes      String?
  assignedTo Int?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       user?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  visitor    visitor  @relation(fields: [visitorId], references: [id], onDelete: Cascade)

  @@index([userId], map: "follow_up_userId_fkey")
  @@index([visitorId], map: "follow_up_visitorId_fkey")
}

model prayer_request {
  id        Int      @id @default(autoincrement())
  visitorId Int?
  userId    Int?
  date      DateTime
  request   String
  status    String   @default("active")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      user?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  visitor   visitor? @relation(fields: [visitorId], references: [id], onDelete: Cascade)

  @@index([userId], map: "prayer_request_userId_fkey")
  @@index([visitorId], map: "prayer_request_visitorId_fkey")
}

model note {
  id        Int      @id @default(autoincrement())
  visitorId Int?
  userId    Int?
  date      DateTime
  author    String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      user?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  visitor   visitor? @relation(fields: [visitorId], references: [id], onDelete: Cascade)

  @@index([userId], map: "note_userId_fkey")
  @@index([visitorId], map: "note_visitorId_fkey")
}

model life_center_role {
  id                 Int                  @id @default(autoincrement())
  name               String
  life_center_member life_center_member[]
}

model life_center {
  id                 Int                  @id @default(autoincrement())
  name               String
  description        String
  meetingLocation    String
  meetingDays        String
  life_center_member life_center_member[]
  soul_won           soul_won[]           @relation("life_center_soul_won")
}

model life_center_member {
  id           Int              @id @default(autoincrement())
  userId       Int
  lifeCenterId Int
  roleId       Int
  lifeCenter   life_center      @relation(fields: [lifeCenterId], references: [id])
  role         life_center_role @relation(fields: [roleId], references: [id])
  user         user             @relation(fields: [userId], references: [id])

  @@unique([userId, lifeCenterId])
  @@index([lifeCenterId], map: "life_center_member_lifeCenterId_fkey")
  @@index([roleId], map: "life_center_member_roleId_fkey")
}

model soul_won {
  id             Int         @id @unique @default(autoincrement())
  title          String?
  first_name     String
  last_name      String
  other_name     String?
  contact_number String
  contact_email  String?
  country_code   String?
  country        String
  city           String
  date_won       DateTime
  wonById        Int
  lifeCenterId   Int
  lifeCenter     life_center @relation("life_center_soul_won", fields: [lifeCenterId], references: [id], map: "soulwon_lifecenter_fkey")
  wonBy          user        @relation("user_soul_winner", fields: [wonById], references: [id], map: "soulwon_wonby_fkey")

  @@index([lifeCenterId], map: "soulwon_lifecenter_fkey")
  @@index([wonById], map: "soulwon_wonby_fkey")
}

model devices {
  id          Int    @id @default(autoincrement())
  device_name String
  ip_address  String
  port        String
  location    String
}

model department_positions {
  id            Int        @id @default(autoincrement())
  user_id       Int
  department_id Int
  position_id   Int?
  department    department @relation(fields: [department_id], references: [id])
  position      position?  @relation(fields: [position_id], references: [id])
  user          user       @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, department_id])
  @@index([user_id])
  @@index([department_id])
  @@index([position_id])
}

model product_type {
  id       Int        @id @default(autoincrement())
  name     String
  deleted  Boolean    @default(false)
  products products[]
}

model product_category {
  id       Int        @id @default(autoincrement())
  name     String
  deleted  Boolean    @default(false)
  products products[]
}

model markets {
  id            Int           @id @default(autoincrement())
  name          String        @unique
  description   String?
  deleted       Boolean       @default(false)
  start_date    DateTime?
  end_date      DateTime?
  created_at    DateTime      @default(now())
  updated_at    DateTime      @updatedAt
  created_by_id Int?
  updated_at_id Int?
  event_mgt_id  Int?
  event         event_mgt?    @relation(fields: [event_mgt_id], references: [id])
  order_items   order_items[]
  products      products[]

  @@index([event_mgt_id], map: "markets_event_mgt_id_fkey")
}

model products {
  id                  Int               @id @default(autoincrement())
  name                String
  description         String?
  deleted             Boolean           @default(false)
  colours             String?
  created_at          DateTime          @default(now())
  updated_at          DateTime          @updatedAt
  created_by_id       Int?
  updated_at_id       Int?
  image_url           String?
  market_id           Int?
  price_amount        Float?
  price_currency      String?
  product_category_id Int?
  product_type_id     Int?
  status              String?           @default("draft")
  stock_managed       String            @default("no")
  order_items         order_items[]
  product_colours     product_colour[]
  market              markets?          @relation(fields: [market_id], references: [id])
  product_category    product_category? @relation(fields: [product_category_id], references: [id])
  product_type        product_type?     @relation(fields: [product_type_id], references: [id])

  @@index([market_id], map: "products_market_id_fkey")
  @@index([product_category_id], map: "products_product_category_id_fkey")
  @@index([product_type_id], map: "products_product_type_id_fkey")
}

model sizes {
  id                   Int             @id @default(autoincrement())
  name                 String          @unique
  sort_order           Int?
  created_at           DateTime        @default(now())
  updated_at           DateTime        @updatedAt
  created_by_id        Int?
  updated_at_id        Int?
  product_colour_stock product_stock[]
}

model product_colour {
  id         Int             @id @default(autoincrement())
  colour     String?
  image_url  String?
  product_id Int
  product    products        @relation(fields: [product_id], references: [id])
  sizes      product_stock[]

  @@index([product_id], map: "product_colour_product_id_fkey")
}

model product_stock {
  product_colour_id Int
  size_id           Int
  stock             Int            @default(0)
  product_colour    product_colour @relation(fields: [product_colour_id], references: [id])
  size              sizes          @relation(fields: [size_id], references: [id])

  @@id([size_id, product_colour_id])
  @@index([product_colour_id], map: "product_stock_product_colour_id_fkey")
}

model orders {
  id              Int              @id @default(autoincrement())
  order_number    String?
  total_amount    Float
  user_id         Int?
  payment_status  payment_status   @default(pending)
  delivery_status delivery_status  @default(pending)
  created_at      DateTime         @default(now())
  updated_at      DateTime         @updatedAt
  reference       String
  billing_details billing_details?
  items           order_items[]
  user            user?            @relation(fields: [user_id], references: [id])

  @@index([user_id], map: "orders_user_id_fkey")
}

model order_items {
  id               Int       @id @default(autoincrement())
  order_id         Int
  name             String
  market_id        Int?
  product_id       Int?
  price_amount     Float
  price_currency   String
  quantity         Int
  product_type     String
  product_category String
  image_url        String
  color            String
  size             String
  market           markets?  @relation(fields: [market_id], references: [id])
  order            orders    @relation(fields: [order_id], references: [id], onDelete: Cascade)
  product          products? @relation(fields: [product_id], references: [id])

  @@index([market_id], map: "order_items_market_id_fkey")
  @@index([order_id], map: "order_items_order_id_fkey")
  @@index([product_id], map: "order_items_product_id_fkey")
}

model billing_details {
  id           Int    @id @default(autoincrement())
  order_id     Int    @unique
  first_name   String
  last_name    String
  email        String
  phone_number String
  country      String
  country_code String
  orders       orders @relation(fields: [order_id], references: [id], onDelete: Cascade)
}

model certificate {
  id                Int      @id @default(autoincrement())
  userId            Int
  programId         Int
  issuedAt          DateTime @default(now())
  certificateNumber String   @unique
  program           program  @relation(fields: [programId], references: [id])
  user              user     @relation(fields: [userId], references: [id])

  @@unique([userId, programId])
  @@index([programId], map: "certificate_programId_fkey")
}

model AnnualTheme {
  id             Int      @id @default(autoincrement())
  year           Int      @unique
  title          String
  verseReference String
  verse          String
  message        String
  imageUrl       String?
  isActive       Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model receiptConfig {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model paymentConfig {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model bankAccountConfig {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  percentage  Float?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model titheBreakdownConfig {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  percentage  Float?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model financials {
  id         String   @id @default(cuid())
  payload    String   @db.LongText
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  periodDate String?  @unique
}

model availability {
  id                     Int            @id @default(autoincrement())
  day                    String
  maxBookingsPerSlot     Int
  startTime              String
  endTime                String
  sessionDurationMinutes Int            @default(30)
  userId                 Int
  user                   user           @relation(fields: [userId], references: [id])
  sessions               session_slot[]

  @@index([userId])
}

model session_slot {
  id             Int          @id @default(autoincrement())
  start          String
  end            String
  availabilityId Int
  availability   availability @relation(fields: [availabilityId], references: [id], onDelete: Cascade)

  @@index([availabilityId], map: "session_slot_availabilityId_fkey")
}

model appointment {
  id          Int                @id @default(autoincrement())
  fullName    String
  email       String
  phone       String
  purpose     String
  note        String?
  date        DateTime
  startTime   String
  endTime     String
  status      appointment_status @default(PENDING)
  createdAt   DateTime           @default(now())
  userId      Int
  requesterId Int?
  user        user               @relation(fields: [userId], references: [id])

  @@index([email])
  @@index([userId])
  @@index([requesterId])
}

model ai_conversation {
  id            String          @id @default(uuid())
  created_by    Int
  title         String?
  status        String          @default("active")
  created_at    DateTime        @default(now())
  updated_at    DateTime        @updatedAt
  messages      ai_message[]
  usage_entries ai_usage_ledger[]

  @@index([created_by])
  @@index([created_at])
}

model ai_message {
  id            String          @id @default(uuid())
  conversation_id String
  role          String
  content       String          @db.LongText
  provider      String?
  model         String?
  created_at    DateTime        @default(now())
  conversation  ai_conversation @relation(fields: [conversation_id], references: [id], onDelete: Cascade)
  usage_entries ai_usage_ledger[]

  @@index([conversation_id, created_at])
  @@index([created_at])
}

model ai_usage_ledger {
  id                String          @id @default(uuid())
  conversation_id   String
  message_id        String
  prompt_tokens     Int
  completion_tokens Int
  total_tokens      Int
  message_count     Int             @default(1)
  cost_estimate     Float?
  provider          String
  model             String
  created_at        DateTime        @default(now())
  conversation      ai_conversation @relation(fields: [conversation_id], references: [id], onDelete: Cascade)
  message           ai_message      @relation(fields: [message_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([conversation_id])
  @@index([provider, model])
}

model ai_usage_quota {
  id               String   @id @default(uuid())
  period_start     DateTime
  period_end       DateTime
  message_limit    Int
  token_limit      Int
  message_used     Int      @default(0)
  token_used       Int      @default(0)
  updated_at       DateTime @updatedAt

  @@unique([period_start, period_end])
  @@index([period_start, period_end])
}

model ai_pricing_catalog {
  id                String   @id @default(cuid())
  provider          String
  model             String
  input_token_cost  Float
  output_token_cost Float
  effective_from    DateTime
  updated_at        DateTime @updatedAt

  @@index([provider, model, effective_from])
}

model ai_audit_log {
  id         String   @id @default(uuid())
  actor_id   Int
  action     String
  resource   String
  metadata   String?  @db.LongText
  created_at DateTime @default(now())

  @@index([actor_id])
  @@index([created_at])
}

model ai_idempotency_key {
  id               String   @id @default(uuid())
  actor_id         Int
  endpoint         String
  key              String
  request_hash     String
  response_payload String?  @db.LongText
  status_code      Int
  created_at       DateTime @default(now())

  @@unique([actor_id, endpoint, key])
  @@index([created_at])
}

model ai_provider_credential {
  id               String   @id @default(uuid())
  provider         String
  encrypted_key    String   @db.LongText
  encrypted_secret String?  @db.LongText
  is_active        Boolean  @default(true)
  created_by       Int
  rotated_at       DateTime?
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt

  @@index([provider, is_active])
  @@index([created_at])
}

enum status_type {
  UNCONFIRMED
  CONFIRMED
  MEMBER
}

enum attendance_group {
  ADULTS
  CHILDREN
  BOTH
}

enum classFormat {
  In_Person
  Online
  Hybrid
}

enum submission_status {
  SUBMITTED
  RESUBMITTED
  GRADED
  RETURNED
}

enum progress_status {
  FAIL
  PASS
  PENDING
}

enum RequestApprovalStatus {
  Draft
  Awaiting_HOD_Approval
  Awaiting_Executive_Pastor_Approval
  APPROVED
  REJECTED
}

enum RequisitionApprovalModule {
  REQUISITION
}

enum RequisitionApproverType {
  HEAD_OF_DEPARTMENT
  POSITION
  SPECIFIC_PERSON
}

enum RequisitionApprovalInstanceStatus {
  WAITING
  PENDING
  APPROVED
  REJECTED
}

enum asset_status {
  ASSIGNED
  UNASSIGNED
  NOT_FIXABLE
  OUT_OF_REPAIRS
  LOST_OR_STOLEN
}

enum marital_status {
  SINGLE
  MARRIED
  DIVORCED
  WIDOW
  WIDOWER
}

enum membership_type {
  ONLINE
  IN_HOUSE
}

enum event_type {
  ACTIVITY
  PROGRAM
  SERVICE
  OTHER
}

enum event_status {
  CONFIRMED
  TENTATIVE
}

enum payment_status {
  pending
  success
  failed
}

enum delivery_status {
  pending
  shipped
  delivered
  cancelled
}

enum appointment_status {
  PENDING
  CONFIRMED
  CANCELLED
}
